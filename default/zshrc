########## Aliases

alias ls="ls --color"

# Add an "alert" alias for long running commands. Use like so: "sleep 10; alert"
alias alert='notify-send --urgency=low -i "$([ $? = 0 ] && echo terminal || echo error)" "$(history|tail -n1|sed -e '\''s/^\s*[0-9]\+\s*//;s/[;&|]\s*alert$//'\'')"'

alias git="nocorrect git"

########## Configure editor

# Use vim keybinds
bindkey -v

# User-install bin
PATH="$HOME/bin":$PATH

if p=`command -v nvim`
then
	alias vim="$p"
	alias vimdiff="$p -d"
	export VISUAL="$p"
else
	export VISUAL="vim"
fi

alias v="$VISUAL"
export EDITOR="$VISUAL"
export GIT_EDITOR="$VISUAL"

########## Open new terminal in current directory in MacOS

if [[ "$TERM_PROGRAM" == "Apple_Terminal" ]]; then
  function chpwd {
    printf '\e]7;%s\a' "file://$HOSTNAME${PWD// /%20}"
  }
  chpwd
fi

########### Load plugins

# source /etc/profile

# load zgen
source "${HOME}/.zgen/zgen.zsh"

# if the init script doesn't exist
if ! zgen saved; then

  # specify plugins here
  zgen load changs/slimzsh
  # antigen bundle zsh-users/zsh-completions
  # antigen bundle zsh-users/zsh-autosuggestions
  zgen load zsh-users/zsh-history-substring-search

  # generate the init script from plugins above
  zgen save
fi

########## Configure plugins

# Use vim keybinds
bindkey -v

# history substring search
bindkey "$terminfo[kcuu1]" history-substring-search-up
bindkey "$terminfo[kcud1]" history-substring-search-down
bindkey '^[[A' history-substring-search-up
bindkey '^[[B' history-substring-search-down
bindkey -M vicmd 'k' history-substring-search-up
bindkey -M vicmd 'j' history-substring-search-down

# Improve autocompletion style
# zstyle ':completion:*' menu select  # select completions with arrow keys
# zstyle ':completion:*' group-name ''  # group results by category
# zstyle ':completion:::::' completer _expand _complete _ignored _approximate  # enable approximate matches for completion

# Fix "git add" autocomplete hanging
__git_files () {
    _wanted files expl 'local files' _files
}

# https://github.com/conda/conda/issues/6826#issuecomment-397287212
if `command -v conda &> /dev/null`
then
	[[ -z $TMUX ]] || conda deactivate; conda activate base
fi
